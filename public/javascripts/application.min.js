function _ajax_request(a,c,e,b,d){if(jQuery.isFunction(c)){e=c;c={}}return jQuery.ajax({type:d,url:a,data:c,success:e,dataType:b})}jQuery.extend({put:function(a,c,d,b){return _ajax_request(a,c,d,b,"PUT")},delete_:function(a,c,d,b){return _ajax_request(a,c,d,b,"DELETE")}});(function(){var a={getSelection:function(){var b=this.jquery?this[0]:this;return(("selectionStart" in b&&function(){var c=b.selectionEnd-b.selectionStart;return{start:b.selectionStart,end:b.selectionEnd,length:c,text:b.value.substr(b.selectionStart,c)}})||(document.selection&&function(){b.focus();var d=document.selection.createRange();if(d===null){return{start:0,end:b.value.length,length:0}}var c=b.createTextRange();var e=c.duplicate();c.moveToBookmark(d.getBookmark());e.setEndPoint("EndToStart",c);return{start:e.text.length,end:e.text.length+d.text.length,length:d.text.length,text:d.text}})||function(){return{start:0,end:b.value.length,length:0}})()},replaceSelection:function(){var b=this.jquery?this[0]:this;var c=arguments[0]||"";return(("selectionStart" in b&&function(){b.value=b.value.substr(0,b.selectionStart)+c+b.value.substr(b.selectionEnd,b.value.length);return this})||(document.selection&&function(){b.focus();document.selection.createRange().text=c;return this})||function(){b.value+=c;return this})()}};jQuery.each(a,function(b){jQuery.fn[b]=this})})();function B3STabs(a,b){a.tabs=[];settings=jQuery.extend({showFirstTab:true},b);a.hideAllTabs=function(){jQuery(this.tabs).each(function(){jQuery(this.tabId).hide();jQuery(this).removeClass("active")})};a.showTab=function(c){this.hideAllTabs();jQuery(c.tabId).show();jQuery(c).addClass("active")};jQuery(a).find("a").each(function(){this.container=a;this.tabId=this.href.match(/(#[\w\d\-_]+)$/)[1];a.tabs.push(this);jQuery(this).click(function(){this.container.showTab(this);return true})});a.hideAllTabs();if(settings.showFirstTab){a.showTab(a.tabs[0])}this.controls=a;this.tabs=this.controls.tabs}function jRichTextArea(b,a){this.textArea=b;settings=jQuery.extend({className:"richTextToolbar"},a);this.toolbar={settings:settings,textArea:b,listElement:false,buttons:[],addButton:function(f,g,e){settings=jQuery.extend({className:f.replace(/[\s]+/,"")+"Button"},e);var c=document.createElement("li");var d=document.createElement("a");d.title=f;d.textArea=this.textArea;jQuery(d).click(g);jQuery(d).addClass(settings.className);jQuery(c).append(d).appendTo(this.listElement);this.buttons.push(c);return this},create:function(){if(!this.listElement){this.listElement=document.createElement("ul");jQuery(this.listElement).addClass(this.settings.className);jQuery(this.listElement).insertBefore(this.textArea)}}};this.textArea.selectedText=function(){return jQuery(this).getSelection().text};this.textArea.replaceSelection=function(c){return jQuery(this).replaceSelection(c)};this.textArea.wrapSelection=function(){var d=arguments[0];var c=(arguments.length>1)?arguments[1]:d;return this.replaceSelection(d+this.selectedText()+c)};this.textArea.toolbar=this.toolbar;this.toolbar.create()}var B3S={loadNewPosts:function(){var a=$("#newPosts").get()[0];var b=$("#discussionLink").get()[0].href.match(/^(https?:\/\/[\w\d\.:]+\/discussions\/[\d]+)/)[1]+"/posts/since/"+a.postsCount;$(a).html("Loading&hellip;");$.get(b,function(c){if($(".posts #ajaxPosts").length<1){$(".posts").append('<div id="ajaxPosts"></div>')}$(".posts #ajaxPosts").append(c);$(".posts #ajaxPosts .post:not(.shown)").hide().slideDown().addClass("shown");$(".shown_items_count").text(a.serverPostsCount)});document.title=a.documentTitle;a.postsCount=a.serverPostsCount;a.shown=false;$(a).fadeOut();return false},applyTabs:function(){jQuery("#reply-tabs").each(function(){window.replyTabs=new B3STabs(this,{showFirstTab:false});if(jQuery("body.last_page").length>0){window.replyTabs.controls.showTab(window.replyTabs.tabs[0])}})},applyRichText:function(){jQuery("textarea.rich").each(function(){var a=new jRichTextArea(this);a.toolbar.addButton("Bold",function(){this.textArea.wrapSelection("<strong>","</strong>")}).addButton("Italics",function(){this.textArea.wrapSelection("<em>","</em>")}).addButton("Link",function(){var c=this.textArea.selectedText();var b=prompt("Enter link URL","");this.textArea.replaceSelection('<a href="'+(b===""?"http://link_url/":b).replace(/^(?!(f|ht)tps?:\/\/)/,"http://")+'">'+((c==="")?"Link text":c)+"</a>")}).addButton("Image",function(){var c=this.textArea.selectedText();if(c===""){var b=prompt("Enter image URL","");if(b===null){return}this.textArea.replaceSelection('<img src="'+b+'" alt="" />')}else{this.textArea.replaceSelection('<img src="'+c+'" alt="" />')}}).addButton("Block Quote",function(){this.textArea.wrapSelection("<blockquote>","</blockquote>")}).addButton("Escape HTML",function(){var b=this.textArea.selectedText();this.textArea.replaceSelection(b.replace(/</g,"&lt;").replace(/>/g,"&gt;"))})})},init:function(){this.applyTabs();this.applyRichText();jQuery("#search_mode").change(function(){this.parentNode.action=this.value});if(jQuery("body.discussion").length>0){window.addToReply=function(b){window.replyTabs.controls.showTab(window.replyTabs.tabs[0]);jQuery("#compose-body").val(jQuery("#compose-body").val()+b)}}window.quotePost=function(b){var c="#post-"+b;if(jQuery(c).length>0){var e=jQuery(c+" .post_info .permalink a").get()[0].href.replace(/^https?:\/\/([\w\d\.:\-]*)/,"");var g=jQuery(c+" .post_info .username a").text();var d=jQuery(c+" .body .content").html().replace(/^[\s]*/,"").replace(/[\s]*$/,"").replace(/<br[\s\/]*>/g,"\n");var f='<blockquote><cite>Posted by <a href="'+e+'">'+g+"</a>:</cite>"+d+"</blockquote>";addToReply(f)}};if(jQuery("#napkin").length>0){window.uploadDrawing=function(){jQuery("#napkin-submit").text("Posting, please wait...");swfobject.getObjectById("napkin").uploadDrawing()};window.onDrawingUploaded=function(b){window.location.reload()};jQuery(".drawing img").each(function(){jQuery(this).click(function(){if(swfobject.getObjectById("napkin")){swfobject.getObjectById("napkin").setBackground(this.src)}})})}if($(".total_items_count").length>0&&$("#newPosts").length>0){var a=$("#newPosts").get()[0];a.postsCount=$(".total_items_count").eq(0).text();a.postsCountUrl=$("#discussionLink").get()[0].href.match(/^(https?:\/\/[\w\d\.:]+\/discussions\/[\d]+)/)[1]+"/posts/count.js";a.documentTitle=document.title;a.refreshInterval=setInterval(function(){$.getJSON(a.postsCountUrl,function(b){if(b.posts_count>a.postsCount){var c=b.posts_count-a.postsCount;$(".total_items_count").text(b.posts_count);if(c>50){$(a).html("<p>New posts have been made since this page was loaded, reload the page to see them.</p>");document.title="[New posts] "+a.documentTitle;clearInterval(a.refreshInterval)}else{var d="A new post has";if(c==1){document.title="["+c+" new post] "+a.documentTitle}else{d=c+" new posts have";document.title="["+c+" new posts] "+a.documentTitle}$(a).html("<p>"+d+' been made since this page was loaded, <a href="'+$("#discussionLink").get()[0].href+'" onclick="B3S.loadNewPosts(); return false;">click here to load</a>.</p>');a.serverPostsCount=b.posts_count}if(!a.shown){$(a).addClass("new_posts_since_refresh").hide().slideDown();a.shown=true}}})},5000)}}};jQuery(document).ready(function(){B3S.init()});