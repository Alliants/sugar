function _ajax_request(b,d,f,c,e){if(jQuery.isFunction(d)){f=d;d={}}return jQuery.ajax({type:e,url:b,data:d,success:f,dataType:c})}jQuery.extend({put:function(b,d,e,c){return _ajax_request(b,d,e,c,"PUT")},delete_:function(b,d,e,c){return _ajax_request(b,d,e,c,"DELETE")}});(function(){var b={getSelection:function(){var c=this.jquery?this[0]:this;return(("selectionStart" in c&&function(){var d=c.selectionEnd-c.selectionStart;return{start:c.selectionStart,end:c.selectionEnd,length:d,text:c.value.substr(c.selectionStart,d)}})||(document.selection&&function(){c.focus();var e=document.selection.createRange();if(e===null){return{start:0,end:c.value.length,length:0}}var d=c.createTextRange();var f=d.duplicate();d.moveToBookmark(e.getBookmark());f.setEndPoint("EndToStart",d);return{start:f.text.length,end:f.text.length+e.text.length,length:e.text.length,text:e.text}})||function(){return{start:0,end:c.value.length,length:0}})()},replaceSelection:function(){var c=this.jquery?this[0]:this;var d=arguments[0]||"";return(("selectionStart" in c&&function(){c.value=c.value.substr(0,c.selectionStart)+d+c.value.substr(c.selectionEnd,c.value.length);return this})||(document.selection&&function(){c.focus();document.selection.createRange().text=d;return this})||function(){c.value+=d;return this})()}};jQuery.each(b,function(c){jQuery.fn[c]=this})})();(function(b){b.fn.flickr=function(d){var c={api_key:null,type:null,photoset_id:null,text:null,user_id:null,group_id:null,tags:null,tag_mode:"any",sort:"relevance",thumb_size:"s",size:null,per_page:100,page:1,attr:"",api_url:null,params:"",api_callback:"?",callback:null};if(d){b.extend(c,d)}return this.each(function(){var f=b("<ul>").appendTo(this);var e=b.flickr.format(c);b.getJSON(e,function(l){if(l.stat!="ok"){for(i in l){if(l[i]){b("<li>").text(i+": "+l[i]).appendTo(f)}}}else{if(c.type=="photoset"){l.photos=l.photoset}f.append('<input type="hidden" value="'+l.photos.page+'" />');f.append('<input type="hidden" value="'+l.photos.pages+'" />');f.append('<input type="hidden" value="'+l.photos.perpage+'" />');f.append('<input type="hidden" value="'+l.photos.total+'" />');for(var m=0;m<l.photos.photo.length;m++){var g=l.photos.photo[m];var j="http://farm"+g.farm+".static.flickr.com/"+g.server+"/"+g.id+"_"+g.secret+"_"+c.thumb_size+".jpg";var k="http://farm"+g.farm+".static.flickr.com/"+g.server+"/"+g.id+"_";switch(c.size){case"m":k+=g.secret+"_m.jpg";break;case"b":k+=g.secret+"_b.jpg";break;case"o":if(g.originalsecret&&g.originalformat){k+=g.originalsecret+"_o."+g.originalformat}else{k+=g.secret+"_b.jpg"}break;default:k+=g.secret+".jpg"}f.append('<li><a href="'+k+'" '+c.attr+' title="'+g.title+'"><img src="'+j+'" alt="'+g.title+'" /></a></li>')}if(c.callback){c.callback(f)}}})})};b.flickr={format:function(d){if(d.url){return d.url}var c="http://api.flickr.com/services/rest/?format=json&jsoncallback="+d.api_callback+"&api_key="+d.api_key;switch(d.type){case"photoset":c+="&method=flickr.photosets.getPhotos&photoset_id="+d.photoset_id;break;case"search":c+="&method=flickr.photos.search&sort="+d.sort;if(d.user_id){c+="&user_id="+d.user_id}if(d.group_id){c+="&group_id="+d.group_id}if(d.tags){c+="&tags="+d.tags}if(d.tag_mode){c+="&tag_mode="+d.tag_mode}if(d.text){c+="&text="+d.text}break;default:c+="&method=flickr.photos.getRecent"}if(d.size=="o"){c+="&extras=original_format"}c+="&per_page="+d.per_page+"&page="+d.page+d.params;return c}}})(jQuery);function B3STabs(b,d){b.tabs=[];settings=jQuery.extend({showFirstTab:true},d);b.hideAllTabs=function(){jQuery(this.tabs).each(function(){jQuery(this.tabId).hide();jQuery(this).removeClass("active")})};b.showTab=function(f){this.hideAllTabs();jQuery(f.tabId).show();jQuery(f).addClass("active")};jQuery(b).find("a").each(function(){this.container=b;this.tabId=this.href.match(/(#[\w\d\-_]+)$/)[1];b.tabs.push(this);jQuery(this).click(function(){this.container.showTab(this);return true})});b.hideAllTabs();var e=false;var c=false;if(document.location.toString().match(/(#[\w\d\-_]+)$/)){e=document.location.toString().match(/(#[\w\d\-_]+)$/)[1];for(a=0;a<b.tabs.length;a++){if(b.tabs[a].tabId==e){b.showTab(b.tabs[a]);c=true}}}if(!c&&settings.showFirstTab){b.showTab(b.tabs[0])}this.controls=b;this.tabs=this.controls.tabs}function jRichTextArea(c,b){this.textArea=c;settings=jQuery.extend({className:"richTextToolbar"},b);this.toolbar={settings:settings,textArea:c,listElement:false,buttons:[],addButton:function(g,h,f){settings=jQuery.extend({className:g.replace(/[\s]+/,"")+"Button"},f);var d=document.createElement("li");var e=document.createElement("a");e.title=g;e.textArea=this.textArea;jQuery(e).click(h);jQuery(e).addClass(settings.className);jQuery(d).append(e).appendTo(this.listElement);this.buttons.push(d);return this},create:function(){if(!this.listElement){this.listElement=document.createElement("ul");jQuery(this.listElement).addClass(this.settings.className);jQuery(this.listElement).insertBefore(this.textArea)}}};this.textArea.selectedText=function(){return jQuery(this).getSelection().text};this.textArea.replaceSelection=function(d){return jQuery(this).replaceSelection(d)};this.textArea.wrapSelection=function(){var e=arguments[0];var d=(arguments.length>1)?arguments[1]:e;return this.replaceSelection(e+this.selectedText()+d)};this.textArea.toolbar=this.toolbar;this.toolbar.create()}var B3S={loadNewPosts:function(){var b=$("#newPosts").get()[0];var c=$("#discussionLink").get()[0].href.match(/^(https?:\/\/[\w\d\.:]+\/discussions\/[\d]+)/)[1]+"/posts/since/"+b.postsCount;$(b).html("Loading&hellip;");$.get(c,function(d){if($(".posts #ajaxPosts").length<1){$(".posts").append('<div id="ajaxPosts"></div>')}$(".posts #ajaxPosts").append(d);$(".posts #ajaxPosts .post:not(.shown)").hide().slideDown().addClass("shown");$(".shown_items_count").text(b.serverPostsCount)});document.title=b.documentTitle;b.postsCount=b.serverPostsCount;b.shown=false;$(b).fadeOut();this.applyPostFunctions();return false},applyTabs:function(){jQuery("#reply-tabs").each(function(){window.replyTabs=new B3STabs(this,{showFirstTab:false});if(jQuery("body.last_page").length>0){window.replyTabs.controls.showTab(window.replyTabs.tabs[0])}});jQuery("#profile-tabs").each(function(){window.profileTabs=new B3STabs(this,{showFirstTab:true})})},applyRichText:function(){jQuery("textarea.rich").each(function(){if(!this.toolbar){var b=new jRichTextArea(this);b.toolbar.addButton("Bold",function(){this.textArea.wrapSelection("<strong>","</strong>")}).addButton("Italics",function(){this.textArea.wrapSelection("<em>","</em>")}).addButton("Link",function(){var d=this.textArea.selectedText();var c=prompt("Enter link URL","");this.textArea.replaceSelection('<a href="'+(c===""?"http://link_url/":c).replace(/^(?!(f|ht)tps?:\/\/)/,"http://")+'">'+((d==="")?"Link text":d)+"</a>")}).addButton("Image",function(){var d=this.textArea.selectedText();if(d===""){var c=prompt("Enter image URL","");if(c===null){return}this.textArea.replaceSelection('<img src="'+c+'" alt="" />')}else{this.textArea.replaceSelection('<img src="'+d+'" alt="" />')}}).addButton("Block Quote",function(){this.textArea.wrapSelection("<blockquote>","</blockquote>")}).addButton("Escape HTML",function(){var c=this.textArea.selectedText();this.textArea.replaceSelection(c.replace(/</g,"&lt;").replace(/>/g,"&gt;"))})}})},applyPostFunctions:function(){$(".quote_post").click(function(){var b=this.id.match(/-([\d]+)$/)[1];window.quotePost(b)});$(".edit_post").click(function(){var b=this.id.match(/-([\d]+)$/)[1];var c=this.href;$("#postBody-"+b).html('<span class="ticker">Loading...</span>');$("#postBody-"+b).load(c,false,function(){B3S.applyRichText()});return false})},init:function(){this.applyTabs();this.applyRichText();jQuery("#search_mode").change(function(){this.parentNode.action=this.value});if(jQuery("body.discussion").length>0){window.addToReply=function(c){window.replyTabs.controls.showTab(window.replyTabs.tabs[0]);jQuery("#compose-body").val(jQuery("#compose-body").val()+c)}}window.quotePost=function(c){var d="#post-"+c;if(jQuery(d).length>0){var f=jQuery(d+" .post_info .permalink a").get()[0].href.replace(/^https?:\/\/([\w\d\.:\-]*)/,"");var h=jQuery(d+" .post_info .username a").text();var e=jQuery(d+" .body .content").html().replace(/^[\s]*/,"").replace(/[\s]*$/,"").replace(/<br[\s\/]*>/g,"\n");var g='<blockquote><cite>Posted by <a href="'+f+'">'+h+"</a>:</cite>"+e+"</blockquote>";addToReply(g)}};this.applyPostFunctions();if(jQuery("#napkin").length>0){window.uploadDrawing=function(){jQuery("#napkin-submit").text("Posting, please wait...");swfobject.getObjectById("napkin").uploadDrawing()};window.onDrawingUploaded=function(c){window.location.reload()};jQuery(".drawing img").each(function(){jQuery(this).click(function(){if(swfobject.getObjectById("napkin")){swfobject.getObjectById("napkin").setBackground(this.src)}})})}if($(".total_items_count").length>0&&$("#newPosts").length>0){var b=$("#newPosts").get()[0];b.postsCount=$(".total_items_count").eq(0).text();b.postsCountUrl=$("#discussionLink").get()[0].href.match(/^(https?:\/\/[\w\d\.:]+\/discussions\/[\d]+)/)[1]+"/posts/count.js";b.documentTitle=document.title;b.refreshInterval=setInterval(function(){$.getJSON(b.postsCountUrl,function(c){if(c.posts_count>b.postsCount){var d=c.posts_count-b.postsCount;$(".total_items_count").text(c.posts_count);if(d>50){$(b).html("<p>New posts have been made since this page was loaded, reload the page to see them.</p>");document.title="[New posts] "+b.documentTitle;clearInterval(b.refreshInterval)}else{var e="A new post has";if(d==1){document.title="["+d+" new post] "+b.documentTitle}else{e=d+" new posts have";document.title="["+d+" new posts] "+b.documentTitle}if($("body.last_page").length>0){$(b).html("<p>"+e+' been made since this page was loaded, <a href="'+$("#discussionLink").get()[0].href+'" onclick="B3S.loadNewPosts(); return false;">click here to load</a>.</p>')}else{$(b).html("<p>"+e+" been made since this page was loaded, move on to the last page to see them.</p>")}b.serverPostsCount=c.posts_count}if(!b.shown){$(b).addClass("new_posts_since_refresh").hide().slideDown();b.shown=true}}})},5000)}$("#flickrProfileURL").each(function(){var c=this.href.split("/");c=c[(c.length-1)];jQuery(function(){$("#flickrPhotos").hide();jQuery("#flickrPhotos").flickr({api_key:"016918184821edf95505d9acd61e64c4",type:"search",user_id:c,per_page:15,callback:function(d){$("#flickrPhotos").show()}})})})}};jQuery(document).ready(function(){B3S.init()});